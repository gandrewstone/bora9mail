<head>
  <title>Bora9Mail</title>
  <script type="text/javascript" src="/ckeditor/ckeditor.js"></script>
  <script type="text/javascript" src="/ckeditor/adapters/jquery.js"></script>
  <script type="text/javascript" src="sjcl.js"></script>
  <script type="text/javascript" src="ecc.js"></script>
  <script type="text/javascript" src="bitcoinjs.js"></script>
  <script type="text/javascript" src="jquery.min.js"></script>
  <script type="text/javascript" src="qrcode.js"></script>

</head>

<body>
{{> page}}
</body>
<!-- body>
<div>
  {{> login}}
</div>
<hr/><br>
  {{> userInfo}}
<hr/>
  {{> messageCatalogLayout}}
  <hr/>
  {{> signupPage}}
  <hr/>
  {{> profilePage}}
  <hr/>
  {{> compose}}
  {{> siteIntro}}
  
</body -->

<template name="page">
  <img id="logout" src="logout.svg"/>
  <div id="serverStatus">
    <img id="serverBackground" src="internet-cloud.svg" />
    <img id="serverCheckX" src={{serverStatus}} />
  </div>
  {{#if showPage "siteIntro"}}
    <table><tr><td>
    {{> login }}
    </td></tr>
    <tr><td>
    {{> siteIntro}}
    </td></tr></table>
  {{else}}
    {{#if showPage "signup"}}
      {{> signupPage}}
    {{else}}
      {{#if loggedIn}}
        <img id="siteicon" src="siteicon.png" />
        {{> userInfo }}
        {{#if showPage "profile"}}
          {{> profilePage}}
        {{else}}
          {{#if showPage "compose"}}
            {{> compose}}
          {{else}}
            {{> messageCatalog}}
          {{/if}}
        {{/if}}
      {{else}}
        {{> login}}
      {{/if}}
    {{/if}}
  {{/if}}
  <br>{{warning}}
  <br>{{error}}
  <br>{{help}}
  {{! > showUsers}}
            <button class="clean">Clean</button>

</template>

<template name="messagePage"> 
  {{#with currentMessage}}
    <br>To: {{personDisplay to}}
    <br>From: {{personDisplay from}}
    <br>Date: {{dateDisplay date}}
    <br>Subject: {{subject}}
    <br>Content:<br>
    {{{message}}}
  <button id="messagePageReply">reply</button>
  <button id="messagePageBack">back</button>
  {{/with}}
</template>


<template name="showUsers">
  <table style="width:100%">
  <tr>
  <td>Name</td>
  <td>Password</td>
  <td>Public Key</td>
  <td>Data</td>
  </tr>
   {{#each users}}
  <tr>
  <td>{{name}}</td>
  <td>{{pass}}</td>
  <td>{{publickey}}</td>
  <td>{{encdata}}</td>
  </tr>
  {{else}}
  <tr>
  <td>No users</td>
  </tr>
  {{/each}} 
  </table>
</template>

<template name="profilePage">
  <br><h2>Profile</h2>
  <br>Classic email address: {{emailAddress}}
  <br>Namecoin Identity (<a href="onename.io">onename.io</a> uses u/[name], <a href="nameid.org">nameid</a> uses id/[name]) <INPUT TYPE=TEXT id="profileNamecoinIdentity" value={{namecoin}}>
  <br>Gravatar <INPUT TYPE=TEXT id="profileGravatarIdentity" value="{{gravatar}}">
  <br><img src="{{avatarUrl}}" height="128" width="128">
  <br>Encryption Keys <button class="genAddr">Generate New Keys</button><br>
  <table style="width:100%">
  <tr>
  <td>Identifier</td>
  <td>Public Address</td>
  <td>Secret Key</td>
  </tr>
  {{#each keys}}
  <tr>
  <td><INPUT TYPE=TEXT class=keyIdentifier value="{{identifier}}" /></td>
  <td>{{pub}}</td>
  <td>{{sec}}</td>
  </tr>
  {{else}}
  <tr>
  <td>No keys</td>
  </tr>
  {{/each}}
  </table>  

  <br><h2>Bitcoin</h2>

  A Bitcoin wallet is stored on your browser, and optionally stored encrypted on the server.  The server does not have access to this wallet since your password is never sent to the server.  You remain in sole control and have sole responsibility for these funds.  The browser will periodically spend from this wallet for various mail-related micro-payments.

  <br>SPAM prevention: when sending an email, autopay up to <INPUT TYPE=TEXT class="inputbits" id="bitcoinEmailSpamAutopayEntry" value={{bitcoinEmailSpamAutopayAmount}}> bits (<INPUT TYPE=TEXT class="inputusd" id="usdEmailSpamAutopayEntry" value={{usdEmailSpamAutopayAmount}}> USD) to send rapidly.
  <br>Tipping: When choosing to include an email "tip" use <INPUT TYPE=TEXT class="inputbits" id="bitcoinEmailSendTipEntry" value={{bitcoinEmailSendTipAmount}}> bits (<INPUT TYPE=TEXT class="inputusd" id="usdEmailSendTipEntry" value={{usdEmailSendTipAmount}}> USD) by default (you can change this per send).  Default collection time  <INPUT TYPE=TEXT class="inputDuration" id="emailSendTipDuration" value={{timify "emailSendTipDuration"}}> (receiver has approximately this amount of time to collect the tip).
  <br>Addresses can require a minimum "tip" or emails will be rejected.  This is often used on externally facing email addresses to eliminate spam.  Typically the recipient of such a message will then reply with a zero pay address if he/she is interested in conversing with you (this will happen automatically upon reply).
  <br>

  <br><h3>Wallet Information</h3>

  Current Balance: {{xbtBalance}} bits.  Approximately ${{usdBalance}} US dollars.
  <br>Add funds to your wallet by sending bitcoin to:  
  <span id="publicQRcode"></span> {{bitcoinWalletPublicKey}}
  <br><strong>!!DO NOT SEND MORE THAN A FEW DOLLARS!!</strong>
  <br>Access: 
  <button id="profileCommit">done</button>
</template>

<template name="signupPage">
    Enter your username:  <INPUT TYPE=TEXT id="signup_username"/>@{{serverDNSname}} ({{usernameValidity}}).
    <br>Public emails can be sent to you at this address.

    <br/><br/>Choose a password or passphrase.  This is never sent to the server and CANNOT be recovered if lost.
    <br/>Choose wisely.
    <br/>password: <INPUT TYPE=PASSWORD id="signup_password"/>
    <br><button id="signupjoin">join</button>
</template>



<template name="login">
  <img id="siteIntroIcon" src="qgrn.svg"/>
  <div id="loginHeader">
  <div id="loginLogo"><img align="middle" src="oval_small.png"/></div><div id="loginText"><h1>Bora9Mail</h1>

  <div id="unme">user: <INPUT TYPE=TEXT autocomplete="on" id="username"/>   </div><div id="pwrd">password: <INPUT TYPE=PASSWORD autocomplete="on" id="password"/> </div><div id="ljbuts"><button id="login">login</button> <button id="signup">join</button></div>
  </div>
  </div>
</template>

<template name="userInfo">
  <div id="showProfile" class={{session "userInfoSelected"}}><img id="myAvatar" src="{{avatar}}" /> {{username}} <img id="btcStack" src="btc.svg" />{{xbtBalance}} {{publicKey}} </div>
</template>
